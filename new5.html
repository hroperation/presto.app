<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Ù†Ø¸Ø§Ù… HR Ø§Ù„Ù…ØªÙƒØ§Ù…Ù„ - Ø§Ù„Ø¥ØµØ¯Ø§Ø± 17.3 (ÙÙ„ØªØ± Ø§Ù„Ù…Ù‡Ø§Ù… Ø§Ù„Ø°ÙƒÙŠ)</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://fonts.googleapis.com/css2?family=Cairo:wght@300;400;600;700;800&display=swap" rel="stylesheet">
    <style>
        :root { --primary: #2563eb; --secondary: #64748b; --accent: #facc15; --bg-main: #f8fafc; }
        body { font-family: 'Cairo', sans-serif; background-color: var(--bg-main); color: #1e293b; }
        .sidebar-link { transition: all 0.3s ease; }
        .sidebar-link.active { background: linear-gradient(90deg, #1e40af 0%, #2563eb 100%); border-left: 4px solid var(--accent); box-shadow: 0 4px 12px rgba(37, 99, 235, 0.2); }
        .hidden-section { display: none; }
        .stat-card { transition: all 0.3s ease; cursor: pointer; }
        .stat-card:hover { transform: translateY(-5px); box-shadow: 0 10px 25px -5px rgba(0, 0, 0, 0.1); }
        .modern-shadow { box-shadow: 0 4px 6px -1px rgba(0, 0, 0, 0.05), 0 2px 4px -1px rgba(0, 0, 0, 0.03); }
        input, select, textarea { border: 1px solid #e2e8f0; border-radius: 0.75rem; padding: 0.6rem 1rem; width: 100%; transition: all 0.2s; background-color: #fff; }
        input:focus { border-color: var(--primary); outline: none; box-shadow: 0 0 0 3px rgba(37, 99, 235, 0.1); }
        .modal { background: rgba(15, 23, 42, 0.7); backdrop-filter: blur(8px); position: fixed; inset: 0; display: none; align-items: center; justify-content: center; z-index: 100; padding: 20px; }
        .modal.active { display: flex; }
        .glass-header { background: rgba(255, 255, 255, 0.9); backdrop-filter: blur(12px); }
        .ai-pulse { animation: pulse 2s infinite; }
        @keyframes pulse { 0% { transform: scale(1); box-shadow: 0 0 0 0 rgba(147, 51, 234, 0.7); } 70% { transform: scale(1.03); box-shadow: 0 0 0 10px rgba(147, 51, 234, 0); } 100% { transform: scale(1); box-shadow: 0 0 0 0 rgba(147, 51, 234, 0); } }
        ::-webkit-scrollbar { width: 6px; }
        ::-webkit-scrollbar-track { background: #f1f5f9; }
        ::-webkit-scrollbar-thumb { background: #cbd5e1; border-radius: 10px; }
        @media print { .no-print { display: none !important; } body { background: white; } main { padding: 0 !important; width: 100% !important; } .print-area { display: block !important; } }
    </style>
</head>
<body class="flex min-h-screen">

    <!-- Sidebar -->
    <aside class="w-72 bg-slate-900 text-white flex-shrink-0 hidden lg:flex flex-col shadow-2xl z-50 no-print">
        <div class="p-8">
            <div class="text-2xl font-extrabold text-transparent bg-clip-text bg-gradient-to-r from-blue-400 to-yellow-400">HR PLATFORM âœ¨</div>
            <p class="text-slate-500 text-[10px] mt-1 font-bold uppercase tracking-widest">Ø§Ù„Ø¥ØµØ¯Ø§Ø± 17.3</p>
        </div>
        <nav class="flex-1 px-4 space-y-2">
            <a href="#" onclick="showSection('dashboard')" class="sidebar-link flex items-center p-3 rounded-xl hover:bg-slate-800 transition active" id="link-dashboard"><span class="ml-3 font-bold">ğŸ“Š Ù„ÙˆØ­Ø© Ø§Ù„ØªØ­ÙƒÙ…</span></a>
            <a href="#" onclick="showSection('employees')" class="sidebar-link flex items-center p-3 rounded-xl hover:bg-slate-800 transition" id="link-employees"><span class="ml-3 font-bold">ğŸ‘¥ Ø¥Ø¯Ø§Ø±Ø© Ø§Ù„Ù…ÙˆØ¸ÙÙŠÙ†</span></a>
<div class="pt-10 px-3 space-y-2">
    <button onclick="downloadFullBackup()" class="w-full bg-slate-800 hover:bg-slate-700 text-slate-300 text-xs py-3 rounded-xl border border-slate-700 font-bold transition-all flex items-center justify-center gap-2">
        ğŸ’¾ ØªØµØ¯ÙŠØ± Ù†Ø³Ø®Ø© Ø§Ø­ØªÙŠØ§Ø·ÙŠØ©
    </button>
    
    <button onclick="document.getElementById('importFile').click()" class="w-full bg-emerald-900/50 hover:bg-emerald-800 text-emerald-200 text-xs py-3 rounded-xl border border-emerald-700 font-bold transition-all flex items-center justify-center gap-2">
        ğŸ“¥ Ø§Ø³ØªØ¹Ø§Ø¯Ø© Ù†Ø³Ø®Ø© Ø§Ø­ØªÙŠØ§Ø·ÙŠØ©
    </button>
    
    <input type="file" id="importFile" class="hidden" accept=".json" onchange="importFullBackup(event)">
</div>        </nav>
        <div class="p-6 border-t border-slate-800">
            <div class="flex items-center gap-3 bg-slate-800/50 p-4 rounded-2xl">
                <div class="w-10 h-10 bg-gradient-to-tr from-blue-600 to-indigo-600 rounded-xl flex items-center justify-center font-bold">M</div>
                <div><p class="text-sm font-bold text-white">Ù…Ø¯ÙŠØ± Ø§Ù„Ù†Ø¸Ø§Ù…</p><p class="text-[10px] text-slate-400" id="current-date-display"></p></div>
            </div>
        </div>
		<div class="px-3 mt-2">
    <button onclick="openModal('modalExportOvertime')" class="w-full bg-orange-800/50 hover:bg-orange-700 text-orange-100 text-xs py-3 rounded-xl border border-orange-700 font-bold transition-all flex items-center justify-center gap-2">
        ğŸ“Š Ø§Ø³ØªØ®Ø±Ø§Ø¬ ØªÙ‚Ø±ÙŠØ± Ø§Ù„Ø¥Ø¶Ø§ÙÙŠ
    </button>
</div>
    </aside>

    <!-- Main Content -->
    <main class="flex-1 flex flex-col overflow-hidden">
        <header class="glass-header shadow-sm p-4 flex justify-between items-center z-40 sticky top-0 border-b border-slate-100 no-print">
            <h2 id="section-title" class="text-xl font-extrabold text-slate-800">Ù„ÙˆØ­Ø© Ø§Ù„ØªØ­ÙƒÙ…</h2>
            <div class="flex items-center gap-3">
                <div class="flex flex-col items-end">
                    <span class="text-[9px] font-bold text-blue-600 mb-1">ØªØ§Ø±ÙŠØ® Ø§Ù„Ù†Ø¸Ø§Ù… Ø§Ù„Ø­Ø§Ù„ÙŠ</span>
                    <input type="date" id="systemDateSelector" onchange="updateSystemDate()" class="bg-slate-50 border-slate-200 text-xs py-1.5 w-40">
                </div>
                <button onclick="showSection('add-employee-form')" class="bg-blue-600 hover:bg-blue-700 text-white px-5 py-2.5 rounded-xl text-sm font-bold shadow-lg transition-all">+ Ù…ÙˆØ¸Ù Ø¬Ø¯ÙŠØ¯</button>
            </div>
        </header>
		
<div id="modalExportOvertime" class="modal">
    <div class="bg-white rounded-[2rem] w-full max-w-md shadow-2xl p-8 relative">
        <button onclick="closeModal('modalExportOvertime')" class="absolute top-6 left-6 text-slate-400 hover:text-red-500 font-black text-xl">âœ–</button>
        <h3 class="text-xl font-black text-slate-800 mb-6 flex items-center gap-2">
            <span>ğŸ“¥</span> ØªØ­Ù…ÙŠÙ„ ØªÙ‚Ø±ÙŠØ± Ø§Ù„Ø¥Ø¶Ø§ÙÙŠ
        </h3>
        
        <div class="space-y-4 font-bold text-xs">
            <div class="bg-slate-50 p-4 rounded-xl text-slate-500 mb-4 border border-slate-100">
                Ø³ÙŠØªÙ… ØªØ­Ù…ÙŠÙ„ Ù…Ù„Ù Excel ÙŠØ­ØªÙˆÙŠ Ø¹Ù„Ù‰ Ø³Ø¬Ù„Ø§Øª Ø§Ù„Ø¥Ø¶Ø§ÙÙŠ Ù„Ø¬Ù…ÙŠØ¹ Ø§Ù„Ù…ÙˆØ¸ÙÙŠÙ† Ø®Ù„Ø§Ù„ Ø§Ù„ÙØªØ±Ø© Ø§Ù„Ù…Ø­Ø¯Ø¯Ø©.
            </div>

            <div class="grid grid-cols-2 gap-4">
                <div>
                    <label class="block mb-1 text-slate-500">Ù…Ù† ØªØ§Ø±ÙŠØ®</label>
                    <input type="date" id="export_start_date">
                </div>
                <div>
                    <label class="block mb-1 text-slate-500">Ø¥Ù„Ù‰ ØªØ§Ø±ÙŠØ®</label>
                    <input type="date" id="export_end_date">
                </div>
            </div>

            <button onclick="downloadOvertimeExcel()" class="w-full bg-green-600 hover:bg-green-700 text-white py-4 rounded-2xl font-black transition shadow-lg mt-4 flex items-center justify-center gap-2">
                <span>ğŸ“„ ØªØ­Ù…ÙŠÙ„ Ù…Ù„Ù Excel</span>
            </button>
        </div>
    </div>
</div>
        <div class="flex-1 overflow-y-auto p-4 md:p-8 space-y-8 print-area">
            <!-- Dashboard -->
            <section id="dashboard" class="space-y-8">
                <div class="grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-4 gap-6 no-print">
                    <div onclick="showSection('employees')" class="stat-card bg-white p-6 rounded-3xl border border-slate-50 modern-shadow text-center"><p class="text-slate-400 font-bold text-[10px] uppercase">Ø§Ù„Ù…ÙˆØ¸ÙÙŠÙ†</p><h3 class="text-3xl font-black text-slate-800 mt-1" id="stat-emp-count">0</h3></div>
                    <div onclick="filterEmployeesByStat('actions')" class="stat-card bg-white p-6 rounded-3xl border border-slate-50 modern-shadow text-center"><p class="text-slate-400 font-bold text-[10px] uppercase text-red-500">Ø§Ù„Ø¥Ù†Ø°Ø§Ø±Ø§Øª</p><h3 class="text-3xl font-black text-red-600 mt-1" id="stat-action-count">0</h3></div>
                    <div onclick="filterEmployeesByStat('leaves')" class="stat-card bg-white p-6 rounded-3xl border border-slate-50 modern-shadow text-center"><p class="text-slate-400 font-bold text-[10px] uppercase text-emerald-500">Ø§Ù„Ø¥Ø¬Ø§Ø²Ø§Øª</p><h3 class="text-3xl font-black text-emerald-600 mt-1" id="stat-leave-count">0</h3></div>
                </div>

                <div class="grid grid-cols-1 lg:grid-cols-4 gap-8">
                    <!-- Dashboard Schedule -->
                    <div class="lg:col-span-3 bg-white rounded-[2.5rem] border border-slate-100 modern-shadow overflow-hidden">
                        <div class="p-8 border-b bg-slate-50/30 font-black text-slate-800 flex justify-between items-center">
                            <span>ğŸ—“ï¸ Ø®Ø±ÙŠØ·Ø© Ø§Ù„Ø¯ÙˆØ§Ù… Ø§Ù„Ø£Ø³Ø¨ÙˆØ¹ÙŠ</span>
                            <span class="text-[10px] text-slate-400 font-bold" id="week-date-range"></span>
                        </div>
                        <div class="overflow-x-auto"><table class="w-full text-right border-collapse whitespace-nowrap"><thead class="bg-slate-50 text-slate-500 text-[10px] font-black uppercase tracking-tighter"><tr id="dashboardScheduleHeadRow"></tr></thead><tbody id="dashboardScheduleTable" class="divide-y divide-slate-100 text-[11px] font-bold"></tbody></table></div>
                    </div>
                    <!-- Birthdays -->
                    <div class="bg-white rounded-[2.5rem] border border-slate-100 modern-shadow overflow-hidden h-fit no-print">
                        <div class="p-6 bg-gradient-to-r from-blue-600 to-blue-800 text-white font-black">ğŸ‚ Ø£Ø¹ÙŠØ§Ø¯ Ù…ÙŠÙ„Ø§Ø¯ Ù‚Ø§Ø¯Ù…Ø©</div>
                        <div id="birthdayList" class="p-6 space-y-4"></div>
                    </div>
                </div>

                <!-- Yearly Leave Schedule -->
                <div class="bg-white rounded-[2.5rem] border border-slate-100 modern-shadow overflow-hidden">
                    <div class="p-8 border-b bg-slate-50/30 font-black text-slate-800 flex justify-between items-center"><div class="flex items-center gap-2"><span class="text-2xl">ğŸ“…</span><span>Ø¬Ø¯ÙˆÙ„ Ø§Ù„Ø¥Ø¬Ø§Ø²Ø§Øª Ø§Ù„Ø³Ù†ÙˆÙŠ</span></div><span class="text-[10px] bg-red-100 text-red-600 px-3 py-1 rounded-full font-bold">ÙŠÙƒØ´Ù Ø§Ù„ØªØ¹Ø§Ø±Ø¶Ø§Øª</span></div>
                    <div class="overflow-x-auto max-h-[400px]"><table class="w-full text-right border-collapse"><thead class="bg-slate-50 text-slate-500 text-[10px] font-black uppercase sticky top-0 z-10"><tr><th class="p-4 border-b">ØªØ§Ø±ÙŠØ® Ø§Ù„Ø¥Ø¬Ø§Ø²Ø©</th><th class="p-4 border-b">Ø§Ù„Ù…ÙˆØ¸ÙÙŠÙ† Ø§Ù„Ø­Ø§Ø¬Ø²ÙŠÙ†</th><th class="p-4 border-b text-center">Ø§Ù„Ø­Ø§Ù„Ø©</th></tr></thead><tbody id="yearlyLeavesTable" class="divide-y divide-slate-100 text-xs font-bold"></tbody></table></div>
                </div>
            </section>

            <!-- Employees List -->
            <section id="employees" class="hidden-section space-y-6 font-bold">
                <div class="bg-white p-6 rounded-[2rem] border border-slate-100 shadow-sm flex items-center gap-4"><input type="text" id="empSearch" onkeyup="searchEmployees()" placeholder="Ø§Ø¨Ø­Ø« Ø¨Ø§Ø³Ù… Ø§Ù„Ù…ÙˆØ¸Ù Ø£Ùˆ Ø§Ù„Ù‚Ø³Ù…..." class="bg-slate-50 border-none flex-1"></div>
                <div class="bg-white rounded-[2rem] border border-slate-100 shadow-sm overflow-hidden"><table class="w-full text-right border-collapse"><thead class="bg-slate-50 text-slate-500 text-xs font-black uppercase tracking-wider"><tr><th class="p-5 border-b">Ø§Ù„Ø§Ø³Ù… Ø§Ù„ÙƒØ§Ù…Ù„</th><th class="p-5 border-b">Ø§Ù„Ù‚Ø³Ù…</th><th class="p-5 border-b text-center">Ø§Ù„Ø¹Ù…Ù„ÙŠØ§Øª</th></tr></thead><tbody id="employeesTableBody" class="divide-y divide-slate-100"></tbody></table></div>
            </section>

            <!-- Add Form -->
            <section id="add-employee-form" class="hidden-section max-w-5xl mx-auto no-print">
                <div class="bg-white p-10 rounded-[3rem] border border-slate-100 shadow-xl">
                    <h2 class="text-3xl font-black text-blue-800 mb-8 flex items-center gap-3"><span>Ø¥Ø¶Ø§ÙØ© Ù…ÙˆØ¸Ù Ø¬Ø¯ÙŠØ¯</span><button onclick="showSection('dashboard')" class="text-xs bg-slate-100 px-3 py-1 rounded-lg text-slate-500">Ø±Ø¬ÙˆØ¹</button></h2>
                    <form id="fullEmployeeForm" onsubmit="saveNewEmployee(event)" class="space-y-8">
                        <div class="grid grid-cols-1 md:grid-cols-3 gap-6">
                            <div><label>Ø§Ù„Ø§Ø³Ù… Ø§Ù„ÙƒØ§Ù…Ù„</label><input type="text" id="f_name" required></div>
                            <div><label>Ø§Ù„Ø±Ù‚Ù… Ø§Ù„ÙˆØ¸ÙŠÙÙŠ</label><input type="text" id="f_id" required></div>
                            <div><label>ØªØ§Ø±ÙŠØ® Ø§Ù„Ù…ÙŠÙ„Ø§Ø¯</label><input type="date" id="f_dob"></div>
                            <div><label>Ø±Ù‚Ù… Ø§Ù„Ù‡Ø§ØªÙ</label><input type="tel" id="f_phone"></div>
                            <div><label>Ø§Ù„Ø¹Ù†ÙˆØ§Ù†</label><input type="text" id="f_address"></div>
                            <div><label>Ø§Ù„Ù‚Ø³Ù…</label><input type="text" id="f_dept"></div>
                            <div><label>Ø§Ù„Ù…Ø³Ù…Ù‰ Ø§Ù„ÙˆØ¸ÙŠÙÙŠ</label><input type="text" id="f_pos"></div>
                            <div><label>Ø§Ù„Ù…Ø±ØªØ¨</label><input type="number" id="f_salary"></div>
                            <div><label>ØªØ§Ø±ÙŠØ® Ø¨Ø¯Ø¡ Ø§Ù„Ø¹Ù…Ù„</label><input type="date" id="f_start_date" onchange="calculateWorkDuration()"></div>
							<div class="md:col-span-2">
    <label class="text-blue-600 font-black">Ù…Ø¯Ø© Ø§Ù„Ø¹Ù…Ù„ (Ø£Ù‚Ø¯Ù…ÙŠØ© Ø§Ù„Ù…ÙˆØ¸Ù)</label>
    <div id="duration_result" class="bg-blue-50 p-3 rounded-xl border border-blue-100 text-blue-800 text-sm font-bold h-[45px] flex items-center">
        --
    </div>
</div>
                            <div><label>Ø±ØµÙŠØ¯ Ø§Ù„Ø¥Ø¬Ø§Ø²Ø§Øª</label><input type="number" id="f_leave_bal" value="30"></div>
                            <div><label>ÙØµÙŠÙ„Ø© Ø§Ù„Ø¯Ù…</label><input type="text" id="f_blood"></div>
                            <div><label>Ø§Ù„Ø¬Ù†Ø³ÙŠØ©</label><input type="text" id="f_nat"></div>
                        </div>
                        <button type="submit" class="w-full bg-blue-600 text-white py-5 rounded-[2rem] font-black text-xl shadow-lg">Ø­ÙØ¸ Ø§Ù„Ù…Ù„Ù Ø¨Ø§Ù„ÙƒØ§Ù…Ù„</button>
                    </form>
                </div>
            </section>

            <!-- Profile View -->
            <section id="employee-profile" class="hidden-section space-y-8 pb-10">
                <div class="flex flex-wrap items-center justify-between gap-4">
                    <div class="flex items-center gap-5">
                        <button onclick="showSection('dashboard')" class="w-14 h-14 bg-white rounded-3xl shadow-sm flex items-center justify-center text-slate-400 font-black text-xl no-print">â¬…ï¸</button>
                        <div><h2 class="text-3xl font-black text-slate-800" id="profile-name-header">--</h2><p class="text-blue-600 font-black text-sm" id="profile-job-header">--</p></div>
                    </div>
                    <div class="flex flex-wrap gap-2 no-print">
                        <button onclick="window.print()" class="bg-slate-900 text-white px-4 py-2 rounded-xl text-[10px] font-black shadow-lg">ğŸ–¨ï¸ Ø·Ø¨Ø§Ø¹Ø©</button>
                        <button onclick="analyzePerformanceWithAI()" class="bg-purple-600 text-white px-4 py-2 rounded-xl text-[10px] font-black shadow-lg ai-pulse">âœ¨ AI</button>
                        <button id="btn-edit-toggle" onclick="toggleEditProfile()" class="bg-slate-500 text-white px-4 py-2 rounded-xl text-[10px] font-black shadow-md">âœï¸ ØªØ¹Ø¯ÙŠÙ„</button>
                        <button id="btn-save-changes" onclick="saveProfileChanges()" class="hidden bg-emerald-600 text-white px-4 py-2 rounded-xl text-[10px] font-black shadow-md">ğŸ’¾ Ø­ÙØ¸</button>
                        <button onclick="openModal('modalSchedule')" class="bg-indigo-600 text-white px-4 py-2 rounded-xl text-[10px] font-black shadow-md">ğŸ•’ Ø§Ù„Ø¯ÙˆØ§Ù…</button>
                        <button onclick="openModal('modalAction')" class="bg-red-600 text-white px-4 py-2 rounded-xl text-[10px] font-black shadow-md">âš ï¸ Ø¥Ù†Ø°Ø§Ø±</button>
                        <button onclick="openModal('modalTask')" class="bg-blue-600 text-white px-4 py-2 rounded-xl text-[10px] font-black shadow-md">ğŸ“‹ Ù…Ù‡Ù…Ø©</button>
						<button onclick="prepareOvertimeModal()" class="bg-orange-500 text-white px-4 py-2 rounded-xl text-[10px] font-black shadow-md hover:bg-orange-600 transition">â³ Ø¥Ø¶Ø§ÙÙŠ</button>
                        <button onclick="openModal('modalLeave')" class="bg-emerald-500 text-white px-4 py-2 rounded-xl text-[10px] font-black shadow-md">ğŸŒ´ Ø¥Ø¬Ø§Ø²Ø©</button>
                        <button onclick="deleteEmployeeProfile()" class="bg-red-50 text-red-600 border border-red-100 px-4 py-2 rounded-xl text-[10px] font-black hover:bg-red-600 hover:text-white transition-all shadow-sm">ğŸ—‘ï¸ Ø­Ø°Ù</button>
                    </div>
                </div>

                <div class="grid grid-cols-1 lg:grid-cols-12 gap-8 font-bold">
                    <div class="lg:col-span-4 space-y-8">
                        <div class="bg-white rounded-[2.5rem] border border-slate-100 shadow-sm overflow-hidden text-center pb-8">
                            <div class="h-24 bg-gradient-to-br from-blue-700 to-indigo-800"></div>
                            <div class="w-24 h-24 bg-white rounded-full mx-auto -mt-12 p-1 shadow-lg flex items-center justify-center text-4xl text-blue-600 font-black" id="profile-avatar">?</div>
                            <h3 class="text-xl font-black mt-4" id="view-name-card">--</h3>
                            <div class="mt-6 flex justify-around border-t pt-4 px-4 text-[10px]">
                                <div><p class="text-slate-400">Ø¥Ù†Ø°Ø§Ø±Ø§Øª</p><p class="text-red-600 font-black text-lg" id="profile-stat-actions">0</p></div>
                                <div><p class="text-slate-400">Ù…Ù‡Ø§Ù…</p><p class="text-blue-600 font-black text-lg" id="profile-stat-tasks">0</p></div>
                                <div><p class="text-slate-400">Ø¥Ø¬Ø§Ø²Ø§Øª</p><p class="text-emerald-600 font-black text-lg" id="profile-stat-leaves">0</p></div>
                            </div>
                        </div>
                        <div class="bg-white p-8 rounded-[2.5rem] border border-slate-100 shadow-sm">
                            <h4 class="font-black text-slate-800 mb-6 flex items-center gap-3">ğŸ•’ Ø¬Ø¯ÙˆÙ„ Ø§Ù„Ø¯ÙˆØ§Ù… Ø§Ù„Ø£Ø³Ø¨ÙˆØ¹ÙŠ</h4>
                            <div id="scheduleListView" class="space-y-3 text-xs"></div>
                        </div>
                    </div>

                    <div class="lg:col-span-8 space-y-8">
                        <div class="bg-white p-10 rounded-[3rem] border border-slate-100 shadow-sm relative">
                            <h3 class="font-black text-slate-800 mb-8 border-b pb-4 text-xl">ğŸ“ Ø§Ù„Ø³Ø¬Ù„ Ø§Ù„ÙƒØ§Ù…Ù„ Ù„Ù„Ù…ÙˆØ¸Ù</h3>
                            <div id="detailed-info-grid" class="grid grid-cols-1 sm:grid-cols-2 md:grid-cols-3 gap-6 text-sm"></div>
                        </div>

                        <div class="space-y-8 no-print">
                            <div class="grid grid-cols-1 md:grid-cols-2 gap-8">
                                <div class="bg-white rounded-[2rem] border overflow-hidden shadow-sm">
                                    <div class="p-5 bg-red-50 text-red-700 font-black border-b">âš ï¸ Ø§Ù„Ø¥Ù†Ø°Ø§Ø±Ø§Øª</div>
                                    <table class="w-full text-right text-[10px] font-bold"><tbody id="profileActionsTable" class="divide-y divide-slate-50"></tbody></table>
                                </div>
                                <div class="bg-white rounded-[2rem] border overflow-hidden shadow-sm">
                                    <div class="p-5 bg-emerald-50 text-emerald-700 font-black border-b">ğŸŒ´ Ø§Ù„Ø¥Ø¬Ø§Ø²Ø§Øª</div>
                                    <table class="w-full text-right text-[10px] font-bold"><tbody id="profileLeavesTable" class="divide-y divide-slate-50"></tbody></table>
                                </div>
                            </div>
							<div class="bg-white rounded-[2rem] border overflow-hidden shadow-sm mt-8 no-print">
    <div class="p-5 bg-orange-50 text-orange-700 font-black border-b flex justify-between items-center">
        <span>â³ Ø³Ø¬Ù„ Ø§Ù„Ø¥Ø¶Ø§ÙÙŠ (Ø§Ù„Ø­Ø¯ Ø§Ù„Ø£Ù‚ØµÙ‰: 20 Ø³Ø§Ø¹Ø©)</span>
        <span id="profile-overtime-stats" class="text-[10px] bg-white px-2 py-1 rounded-lg border border-orange-200"></span>
    </div>
    <table class="w-full text-right text-[10px] font-bold">
        <thead class="bg-slate-50 text-slate-400 border-b">
            <tr>
                <th class="p-3">Ø§Ù„ØªØ§Ø±ÙŠØ®</th>
                <th class="p-3">Ø§Ù„Ø³Ø§Ø¹Ø§Øª</th>
                <th class="p-3">Ø§Ù„Ø³Ø¨Ø¨</th>
                <th class="p-3 text-left">Ø­Ø°Ù</th>
            </tr>
        </thead>
        <tbody id="profileOvertimeTable" class="divide-y divide-slate-50"></tbody>
    </table>
</div>
                            <div class="bg-white rounded-[2.5rem] border border-slate-100 overflow-hidden shadow-sm">
                                <div class="p-6 bg-slate-900 text-white font-black flex justify-between items-center">
                                    <span>ğŸ“‹ Ø³Ø¬Ù„ Ø§Ù„Ù…Ù‡Ø§Ù…</span>
                                    <select id="taskFilter" onchange="filterProfileTasks()" class="bg-slate-800 text-white text-[10px] border-none rounded-lg px-2 py-1 w-auto outline-none focus:ring-1 focus:ring-blue-400">
                                        <option value="Ø§Ù„ÙƒÙ„">ÙÙ„ØªØ±Ø©: Ø§Ù„ÙƒÙ„</option>
                                        <option value="Ø¹Ù…Ù„ÙŠØ§Øª">Ø¹Ù…Ù„ÙŠØ§Øª</option>
                                        <option value="Ø±Ø³Ø§Ø¦Ù„ Ø§Ù„ØµÙØ­Ø© + ØªØ·Ø¨ÙŠÙ‚ Ø§Ù„Ø¹Ù…ÙŠÙ„">Ø±Ø³Ø§Ø¦Ù„ Ø§Ù„ØµÙØ­Ø© + ØªØ·Ø¨ÙŠÙ‚ Ø§Ù„Ø¹Ù…ÙŠÙ„</option>
                                        <option value="Ø§Ù„Ù…ÙƒØ§Ù„Ù…Ø§Øª">Ø§Ù„Ù…ÙƒØ§Ù„Ù…Ø§Øª</option>
                                        <option value="Ø±Ø³Ø§Ø¦Ù„ ØªØ·Ø¨ÙŠÙ‚ Ø¨Ø±ÙŠØ³ØªÙˆÙ…Ø§Ù†">Ø±Ø³Ø§Ø¦Ù„ ØªØ·Ø¨ÙŠÙ‚ Ø¨Ø±ÙŠØ³ØªÙˆÙ…Ø§Ù†</option>
                                        <option value="Ø§ÙƒØªÙ">Ø§ÙƒØªÙ</option>
                                        <option value="ÙƒÙˆÙ†ØªØ§ÙƒØª">ÙƒÙˆÙ†ØªØ§ÙƒØª</option>
                                        <option value="Ù…ØªØ§Ø¨Ø¹Ø©">Ù…ØªØ§Ø¨Ø¹Ø©</option>
                                    </select>
                                </div>
	
</div>

                                <table class="w-full text-right text-xs">
                                    <thead class="bg-slate-50 text-slate-500 font-black border-b">
                                        <tr><th class="p-4">Ø§Ù„ØªØ§Ø±ÙŠØ®</th><th class="p-4">Ø§Ù„Ù…Ù‡Ù…Ø©</th><th class="p-4 text-center">Ø¬ÙˆØ¯Ø©%</th><th class="p-4 text-center">Ø§Ù„Ø¹Ø¯Ø¯</th></tr>
                                    </thead>
                                    <tbody id="tasksListBody" class="divide-y divide-slate-50"></tbody>
                                </table>
                            </div>
                        </div>
                    </div>
                </div>
            </section>
        </div>
    </main>

    <!-- Modals -->
    <div id="modalAI" class="modal"><div class="bg-white rounded-[2.5rem] w-full max-w-2xl shadow-2xl p-8 flex flex-col max-h-[90vh] relative"><button onclick="closeModal('modalAI')" class="absolute top-6 left-6 text-slate-400 hover:text-red-500 font-black text-xl">âœ–</button><div class="p-4 bg-purple-700 text-white font-black rounded-t-xl">âœ¨ Gemini Ø§Ù„Ø°ÙƒÙŠ</div><div id="aiResultContent" class="p-6 overflow-y-auto flex-1 font-bold text-sm leading-relaxed"></div></div></div>
    <div id="modalSchedule" class="modal"><div class="bg-white rounded-[2.5rem] w-full max-w-2xl shadow-2xl p-8 flex flex-col relative max-h-[90vh]"><button onclick="closeModal('modalSchedule')" class="absolute top-6 left-6 text-slate-400 hover:text-red-500 font-black text-xl">âœ–</button><h3 class="text-xl font-black mb-6 text-indigo-700 border-b pb-4">ØªØ®ØµÙŠØµ Ø§Ù„Ø¯ÙˆØ§Ù…</h3><div id="scheduleInputs" class="space-y-4 overflow-y-auto pr-2"></div><div class="mt-8 flex gap-3"><button onclick="saveWeeklySchedule()" class="flex-1 bg-indigo-700 text-white py-4 rounded-2xl font-black shadow-lg">Ø­ÙØ¸</button></div></div></div>
<div id="modalLeave" class="modal">
    <div class="bg-white rounded-[2rem] w-full max-w-md shadow-2xl p-8 relative">
        <button onclick="closeModal('modalLeave')" class="absolute top-6 left-6 text-slate-400 hover:text-red-500 font-black text-xl">âœ–</button>
        <h3 class="text-xl font-black text-emerald-600 mb-6" id="leaveModalTitle">Ø·Ù„Ø¨ Ø¥Ø¬Ø§Ø²Ø©</h3>
        <div class="space-y-4 font-bold text-xs">
            <input type="hidden" id="leave_index">
            
            <div>
                <label class="block mb-1 text-slate-500">Ù†ÙˆØ¹ Ø§Ù„Ø¥Ø¬Ø§Ø²Ø©</label>
                <select id="leave_type">
                    <option>Ù…Ø±Ø¶ÙŠØ©</option>
                    <option>Ø·Ø§Ø±Ø¦Ø©</option>
                    <option>Ø³Ù†ÙˆÙŠØ©</option>
                </select>
            </div>

            <div class="grid grid-cols-2 gap-4">
                <div>
                    <label class="block mb-1 text-slate-500">Ù…Ù† ØªØ§Ø±ÙŠØ®</label>
                    <input type="date" id="leave_from">
                </div>
                <div>
                    <label class="block mb-1 text-slate-500">Ø¥Ù„Ù‰ ØªØ§Ø±ÙŠØ®</label>
                    <input type="date" id="leave_to">
                </div>
            </div>

            <div>
                <label class="block mb-1 text-slate-500">Ø§Ù„Ø³Ø¨Ø¨ / Ø§Ù„ØªÙØ§ØµÙŠÙ„</label>
                <textarea id="leave_reason" placeholder="Ø§Ù„ØªÙØ§ØµÙŠÙ„"></textarea>
            </div>

            <button onclick="saveLeave()" class="w-full bg-emerald-600 text-white py-4 rounded-2xl font-black hover:bg-emerald-700 transition">Ø­ÙØ¸ Ø§Ù„Ø¥Ø¬Ø§Ø²Ø©</button>
        </div>
    </div>
</div>   
<div id="modalOvertime" class="modal">
    <div class="bg-white rounded-[2rem] w-full max-w-md shadow-2xl p-8 relative">
        <button onclick="closeModal('modalOvertime')" class="absolute top-6 left-6 text-slate-400 hover:text-red-500 font-black text-xl">âœ–</button>
        <h3 class="text-xl font-black text-orange-600 mb-6">ØªØ³Ø¬ÙŠÙ„ Ø³Ø§Ø¹Ø§Øª Ø¥Ø¶Ø§ÙÙŠ</h3>
        
        <div class="bg-orange-50 p-3 rounded-xl mb-4 text-center border border-orange-100">
            <span class="text-xs font-bold text-orange-800">Ø§Ù„Ø±ØµÙŠØ¯ Ø§Ù„Ù…ØªØ§Ø­: </span>
            <span id="overtime_remaining_display" class="text-lg font-black text-orange-600">--</span>
            <span class="text-xs font-bold text-orange-800"> Ø³Ø§Ø¹Ø©</span>
        </div>

        <div class="space-y-4 font-bold text-xs">
            <div>
                <label class="block mb-1 text-slate-500">Ø§Ù„ØªØ§Ø±ÙŠØ®</label>
                <input type="date" id="overtime_date">
            </div>
            
            <div>
                <label class="block mb-1 text-slate-500">Ø¹Ø¯Ø¯ Ø§Ù„Ø³Ø§Ø¹Ø§Øª</label>
                <input type="number" id="overtime_hours" placeholder="Ù…Ø«Ù„Ø§Ù‹: 2" min="1" max="20">
            </div>

            <div>
                <label class="block mb-1 text-slate-500">Ø§Ù„Ø³Ø¨Ø¨</label>
                <select id="overtime_reason">
                    <option value="Ù†Ù‚Øµ Ø§Ø°Ù†">Ù†Ù‚Øµ Ø§Ø°Ù†</option>
                    <option value="Ù†Ù‚Øµ Ø§Ø¬Ø§Ø²Ø©">Ù†Ù‚Øµ Ø§Ø¬Ø§Ø²Ø©</option>
                    <option value="Ø¶ØºØ· Ø¹Ù…Ù„">Ø¶ØºØ· Ø¹Ù…Ù„</option>
                    <option value="Ø§Ø­ÙˆØ§Ù„ Ø¬ÙˆÙŠØ©">Ø§Ø­ÙˆØ§Ù„ Ø¬ÙˆÙŠØ©</option>
                    <option value="Ø­Ø±Ø¨">Ø­Ø±Ø¨</option>
                </select>
            </div>

            <button onclick="saveOvertime()" class="w-full bg-orange-500 hover:bg-orange-600 text-white py-4 rounded-2xl font-black transition shadow-lg">Ø­ÙØ¸ Ø§Ù„Ø³Ø§Ø¹Ø§Øª</button>
        </div>
    </div>
</div>
 <div id="modalAction" class="modal"><div class="bg-white rounded-[2rem] w-full max-w-md shadow-2xl p-8 relative"><button onclick="closeModal('modalAction')" class="absolute top-6 left-6 text-slate-400 hover:text-red-500 font-black">âœ–</button><h3 class="text-xl font-black text-red-600 mb-6">Ø¥Ù†Ø°Ø§Ø±</h3><div class="space-y-4 font-bold text-xs"><select id="act_type"><option>ØªØ£Ø®ÙŠØ±</option><option>Ù„ÙØª Ù†Ø¸Ø±</option><option>Ø¥Ù†Ø°Ø§Ø± Ø´ÙÙ‡ÙŠ</option><option>Ø¥Ø¬Ø±Ø§Ø¡ Ø¬Ø²Ø§Ø¦ÙŠ</option></select><input type="date" id="act_date"><textarea id="act_reason" placeholder="Ø§Ù„Ø³Ø¨Ø¨"></textarea><button onclick="saveAction()" class="w-full bg-red-600 text-white py-4 rounded-2xl font-black">Ø­ÙØ¸</button></div></div></div>
    <div id="modalTask" class="modal">
        <div class="bg-white rounded-[2rem] w-full max-w-md shadow-2xl p-8 relative">
            <button onclick="closeModal('modalTask')" class="absolute top-6 left-6 text-slate-400 hover:text-red-500 font-black">âœ–</button>
            <h3 class="text-xl font-black text-blue-600 mb-6 uppercase tracking-wider">ØªÙ‚ÙŠÙŠÙ… Ù…Ù‡Ù…Ø©</h3>
            <div class="space-y-4 font-bold text-xs">
                <div>
                    <label>Ù†ÙˆØ¹ Ø§Ù„Ù…Ù‡Ù…Ø©</label>
                    <select id="task_type" class="mt-1">
                        <option value="Ø¹Ù…Ù„ÙŠØ§Øª">Ø¹Ù…Ù„ÙŠØ§Øª</option>
                        <option value="Ø±Ø³Ø§Ø¦Ù„ Ø§Ù„ØµÙØ­Ø© + ØªØ·Ø¨ÙŠÙ‚ Ø§Ù„Ø¹Ù…ÙŠÙ„">Ø±Ø³Ø§Ø¦Ù„ Ø§Ù„ØµÙØ­Ø© + ØªØ·Ø¨ÙŠÙ‚ Ø§Ù„Ø¹Ù…ÙŠÙ„</option>
                        <option value="Ø§Ù„Ù…ÙƒØ§Ù„Ù…Ø§Øª">Ø§Ù„Ù…ÙƒØ§Ù„Ù…Ø§Øª</option>
                        <option value="Ø±Ø³Ø§Ø¦Ù„ ØªØ·Ø¨ÙŠÙ‚ Ø¨Ø±ÙŠØ³ØªÙˆÙ…Ø§Ù†">Ø±Ø³Ø§Ø¦Ù„ ØªØ·Ø¨ÙŠÙ‚ Ø¨Ø±ÙŠØ³ØªÙˆÙ…Ø§Ù†</option>
                        <option value="Ø§ÙƒØªÙ">Ø§ÙƒØªÙ</option>
                        <option value="ÙƒÙˆÙ†ØªØ§ÙƒØª">ÙƒÙˆÙ†ØªØ§ÙƒØª</option>
                        <option value="Ù…ØªØ§Ø¨Ø¹Ø©">Ù…ØªØ§Ø¨Ø¹Ø©</option>
                    </select>
                </div>
                <div class="grid grid-cols-2 gap-4">
                    <div><label>Ø§Ù„Ø¬ÙˆØ¯Ø© %</label><input type="number" id="task_quality" placeholder="100"></div>
                    <div><label>Ø§Ù„Ø¹Ø¯Ø¯</label><input type="number" id="task_count" placeholder="10"></div>
                </div>
                <div><label>ØªØ§Ø±ÙŠØ® Ø§Ù„Ø¥Ù†Ø¬Ø§Ø²</label><input type="date" id="task_date"></div>
                <button onclick="saveTask()" class="w-full bg-blue-600 text-white py-4 rounded-2xl font-black shadow-lg">Ø­ÙØ¸ Ø§Ù„ØªÙ‚ÙŠÙŠÙ…</button>
            </div>
        </div>
    </div>

    <script>
        const apiKey = ""; 
        const weekDays = ["Ø§Ù„Ø³Ø¨Øª", "Ø§Ù„Ø£Ø­Ø¯", "Ø§Ù„Ø§Ø«Ù†ÙŠÙ†", "Ø§Ù„Ø«Ù„Ø§Ø«Ø§Ø¡", "Ø§Ù„Ø£Ø±Ø¨Ø¹Ø§Ø¡", "Ø§Ù„Ø®Ù…ÙŠØ³", "Ø§Ù„Ø¬Ù…Ø¹Ø©"];
        let employees = JSON.parse(localStorage.getItem('hr_v17_data')) || [];
        let currentEmpId = null;

        let systemDate = localStorage.getItem('hr_system_date') ? new Date(localStorage.getItem('hr_system_date')) : new Date();

        function updateSystemDateUI() {
            const dateStr = systemDate.toISOString().split('T')[0];
            document.getElementById('systemDateSelector').value = dateStr;
            document.getElementById('current-date-display').innerText = systemDate.toLocaleDateString('ar-EG', { weekday: 'long', year: 'numeric', month: 'long', day: 'numeric' });
        }

        function updateSystemDate() {
            const newDateVal = document.getElementById('systemDateSelector').value;
            if (newDateVal) {
                systemDate = new Date(newDateVal);
                localStorage.setItem('hr_system_date', newDateVal);
                updateSystemDateUI();
				if(document.getElementById('f_start_date').value) calculateWorkDuration();
                if(document.getElementById('dashboard').classList.contains('hidden-section') === false) {
                    showSection('dashboard');
                }
            }
        }

        function showSection(id) {
            document.querySelectorAll('section').forEach(s => s.classList.add('hidden-section'));
            document.getElementById(id).classList.remove('hidden-section');
            document.querySelectorAll('.sidebar-link').forEach(l => l.classList.remove('active'));
            if(document.getElementById('link-'+id)) document.getElementById('link-'+id).classList.add('active');
            if(id === 'dashboard') { updateDashboardStats(); renderDashboardSchedule(); renderUpcomingBirthdays(); renderYearlyLeaves(); }
            if(id === 'employees') renderEmployeeList();
        }

        function openModal(id) { if(id === 'modalSchedule') prepareScheduleModal(); document.getElementById(id).classList.add('active'); }
        function closeModal(id) { 
            document.getElementById(id).classList.remove('active');
            if(id === 'modalLeave') { document.getElementById('leaveModalTitle').innerText = "Ø·Ù„Ø¨ Ø¥Ø¬Ø§Ø²Ø© Ø¬Ø¯ÙŠØ¯Ø©"; document.getElementById('leave_index').value = ""; document.getElementById('leave_reason').value = ""; }
        }

        function saveToStorage() { localStorage.setItem('hr_v17_data', JSON.stringify(employees)); }

        function getDatesOfCurrentWeek() {
            const baseDate = new Date(systemDate);
            const dayOfWeek = baseDate.getDay(); 
            const daysToSubtract = (dayOfWeek === 6) ? 0 : (dayOfWeek + 1);
            const weekDates = [];
            const startDay = new Date(baseDate);
            startDay.setDate(baseDate.getDate() - daysToSubtract);
            for(let i=0; i<7; i++) {
                const d = new Date(startDay);
                d.setDate(startDay.getDate() + i);
                weekDates.push(d.toISOString().split('T')[0]);
            }
            return weekDates;
        }

     function renderDashboardSchedule() {
    const tableHeadRow = document.getElementById('dashboardScheduleHeadRow');
    const tableBody = document.getElementById('dashboardScheduleTable');
    const currentWeekDates = getDatesOfCurrentWeek();

    // 1. ØªØ¹Ø±ÙŠÙ Ø§Ù„Ø´ÙØªØ§Øª Ø§Ù„Ø±Ø³Ù…ÙŠØ©
    const officialShifts = [
        { label: "08:00 - 03:00", from: "08:00", to: "15:00" },
        { label: "09:00 - 04:00", from: "09:00", to: "16:00" },
        { label: "12:00 - 07:00", from: "12:00", to: "19:00" },
        { label: "04:00 - 11:00", from: "16:00", to: "23:00" },
        { label: "07:00 - 02:00", from: "19:00", to: "02:00" }
    ];

    // 2. Ø¨Ù†Ø§Ø¡ Ø§Ù„Ù‡ÙŠØ¯Ø±
    let headerHTML = `<th class="p-4 border-b border-l bg-slate-50 sticky right-0 z-10 text-slate-600 text-xs font-bold">Ø§Ù„Ø´ÙØª</th>`;
    weekDays.forEach((day, index) => {
        const dateObj = new Date(currentWeekDates[index]);
        headerHTML += `<th class="p-4 border-b text-center bg-slate-50 font-black text-[11px] text-slate-700">
            <div class="flex flex-col">
                <span>${day}</span>
                <span class="text-[9px] font-normal text-slate-400 mt-1">${dateObj.getDate()}/${dateObj.getMonth()+1}</span>
            </div>
        </th>`;
    });
    tableHeadRow.innerHTML = headerHTML;

    // 3. Ø¨Ù†Ø§Ø¡ ØµÙÙˆÙ Ø§Ù„Ø´ÙØªØ§Øª Ù…Ø¹ Ø£Ø³Ù…Ø§Ø¡ Ù†ØµÙŠØ© Ø¨Ø³ÙŠØ·Ø©
    let bodyHTML = "";
    officialShifts.forEach(shift => {
        bodyHTML += `<tr class="hover:bg-slate-50 transition border-b border-slate-100">
            <td class="p-4 border-l bg-slate-50 sticky right-0 z-10 font-bold text-slate-600 text-[10px] text-center">
                ${shift.label}
            </td>`;

        weekDays.forEach(day => {
            const employeesInShift = employees.filter(emp => {
                const s = emp.schedule[day];
                if (!s || s.type === 'Ø¹Ø·Ù„Ø©') return false;
                return s.from === shift.from && s.to === shift.to;
            });

            if (employeesInShift.length > 0) {
                // ØªØ¹Ø¯ÙŠÙ„ Ù‡Ù†Ø§: Ø¹Ø±Ø¶ Ø§Ù„Ø§Ø³Ù… ÙƒÙ†Øµ ÙÙ‚Ø· Ù…Ø¹ Ù„Ù…Ø³Ø© ØªÙ†Ø³ÙŠÙ‚ Ø¨Ø³ÙŠØ·Ø©
                const names = employeesInShift.map(e => 
                    `<div class="text-blue-600 text-[11px] font-bold py-1 leading-tight">
                        â€¢ ${e.name}
                    </div>`
                ).join('');
                bodyHTML += `<td class="p-2 border-l border-slate-50 align-top">${names}</td>`;
            } else {
                bodyHTML += `<td class="p-2 border-l border-slate-50 bg-slate-50/20"></td>`;
            }
        });

        bodyHTML += `</tr>`;
    });

    tableBody.innerHTML = bodyHTML;
}
        function renderScheduleView(emp) {
            const dates = getDatesOfCurrentWeek();
            document.getElementById('scheduleListView').innerHTML = weekDays.map((d,i) => {
                const s = emp.schedule[d] || {type:'Ø¹Ù…Ù„', from:'08:00', to:'16:00'};
                const dObj = new Date(dates[i]);
                return `<div class="flex justify-between items-center p-3 rounded-2xl border border-slate-50 shadow-sm ${s.type==='Ø¹Ø·Ù„Ø©'?'bg-red-50 text-red-600':'bg-slate-50'}"><div><span class="block text-[11px] font-black">${d}</span><span class="text-[9px] text-slate-400">${dObj.getDate()}/${dObj.getMonth()+1}</span></div><span class="text-[11px] font-black">${s.type==='Ø¹Ø·Ù„Ø©'?'Ø±Ø§Ø­Ø©':s.from+'-'+s.to}</span></div>`;
            }).join('');
        }
function renderYearlyLeaves() {
    const container = document.getElementById('yearlyLeavesTable');
    const allLeaves = [];
    
    // ØªÙÙƒÙŠÙƒ Ø§Ù„ÙØªØ±Ø§Øª Ø¥Ù„Ù‰ Ø£ÙŠØ§Ù… Ù…ÙØ±Ø¯Ø© Ù„Ù„Ø¹Ø±Ø¶ ÙÙŠ Ø§Ù„Ø¬Ø¯ÙˆÙ„ Ø§Ù„Ø³Ù†ÙˆÙŠ
    employees.forEach(e => {
        (e.leaves || []).forEach(l => {
            if (l.from && l.to) {
                // Ø¥Ø°Ø§ ÙƒØ§Ù†Øª ÙØªØ±Ø©ØŒ Ù‚Ù… Ø¨ØªÙƒØ±Ø§Ø±Ù‡Ø§ Ù„ÙƒÙ„ ÙŠÙˆÙ…
                const range = getDatesInRange(l.from, l.to);
                range.forEach(dateStr => {
                    allLeaves.push({ date: dateStr, type: l.type, empName: e.name, empId: e.id, isRange: true });
                });
            } else if (l.date) {
                // Ø¯Ø¹Ù… Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ù‚Ø¯ÙŠÙ…Ø© (ÙŠÙˆÙ… ÙˆØ§Ø­Ø¯)
                allLeaves.push({ ...l, empName: e.name, empId: e.id });
            }
        });
    });

    allLeaves.sort((a, b) => new Date(a.date) - new Date(b.date));
    
    const grouped = {};
    allLeaves.forEach(l => { 
        if(!grouped[l.date]) grouped[l.date] = []; 
        grouped[l.date].push(l); 
    });

    if (Object.keys(grouped).length === 0) { 
        container.innerHTML = '<tr><td colspan="3" class="p-8 text-center text-slate-400 italic">Ù„Ø§ ØªÙˆØ¬Ø¯ Ø¥Ø¬Ø§Ø²Ø§Øª Ù…Ø­Ø¬ÙˆØ²Ø©</td></tr>'; 
        return; 
    }

    container.innerHTML = Object.keys(grouped).sort().map(date => {
        const group = grouped[date];
        const isConflict = group.length > 1;
        const names = group.map(g => `<span class="bg-blue-100 text-blue-800 px-2 py-1 rounded text-[10px] whitespace-nowrap">${g.empName} (${g.type})</span>`).join(' ');
        
        return `<tr class="hover:bg-slate-50 border-b border-slate-50 transition-all ${isConflict ? 'bg-red-50' : ''}">
            <td class="p-4 text-slate-500 font-bold text-xs whitespace-nowrap">${date}</td>
            <td class="p-4 flex flex-wrap gap-2">${names}</td>
            <td class="p-4 text-center">${isConflict ? '<span class="text-red-600 font-black text-xs">âš ï¸ ØªØ¹Ø§Ø±Ø¶</span>' : '<span class="text-emerald-600 font-bold text-xs">Ù…ØªØ§Ø­</span>'}</td>
        </tr>`;
    }).join('');
}
        function viewProfile(id) {
		
            try {
                currentEmpId = id; 
                const emp = employees.find(e => e.id == id);
                if(!emp) { alert('Ù„Ù… ÙŠØªÙ… Ø§Ù„Ø¹Ø«ÙˆØ± Ø¹Ù„Ù‰ Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ù…ÙˆØ¸Ù!'); return; }
                document.getElementById('profile-name-header').innerText = emp.name;
                document.getElementById('profile-job-header').innerText = emp.details['Ø§Ù„Ù…Ø³Ù…Ù‰'];
                document.getElementById('view-name-card').innerText = emp.name;
                document.getElementById('profile-avatar').innerText = emp.name.charAt(0);
                document.getElementById('taskFilter').value = "Ø§Ù„ÙƒÙ„"; // Reset filter on view
                updateProfileStats(emp); renderDetailedGrid(emp); renderScheduleView(emp); 
                renderTaskTable(emp); renderActionTable(emp); renderLeaveTable(emp);renderOvertimeTable(emp); 
                document.getElementById('btn-edit-toggle').classList.remove('hidden');
                document.getElementById('btn-save-changes').classList.add('hidden');
                showSection('employee-profile');
            } catch(error) { console.error(error); alert("Ø®Ø·Ø£ ÙÙŠ Ø§Ù„Ø¹Ø±Ø¶"); }
			
        }

        function updateProfileStats(emp) {
            document.getElementById('profile-stat-actions').innerText = (emp.actions || []).length;
            document.getElementById('profile-stat-tasks').innerText = (emp.tasks || []).length;
            document.getElementById('profile-stat-leaves').innerText = (emp.leaves || []).length;
        }

        function renderDetailedGrid(emp) {
    const grid = document.getElementById('detailed-info-grid');
    
    // 1. Ø­Ø³Ø§Ø¨ Ø§Ù„Ù…Ø¯Ø© ØªÙ„Ù‚Ø§Ø¦ÙŠØ§Ù‹ Ø¨Ù†Ø§Ø¡Ù‹ Ø¹Ù„Ù‰ ØªØ§Ø±ÙŠØ® "Ø¨Ø¯Ø§ÙŠØ© Ø§Ù„Ø¹Ù…Ù„" Ø§Ù„Ù…Ø®Ø²Ù†
    let durationText = "Ù„Ù… ÙŠØ­Ø¯Ø¯";
    const startVal = emp.details["Ø¨Ø¯Ø§ÙŠØ© Ø§Ù„Ø¹Ù…Ù„"];
    if (startVal) {
        const start = new Date(startVal);
        const today = new Date(systemDate); // ÙŠØ³ØªØ®Ø¯Ù… ØªØ§Ø±ÙŠØ® Ø§Ù„Ù†Ø¸Ø§Ù… Ø§Ù„Ø­Ø§Ù„ÙŠ
        if (start <= today) {
            let y = today.getFullYear() - start.getFullYear();
            let m = today.getMonth() - start.getMonth();
            let d = today.getDate() - start.getDate();
            if (d < 0) { d += new Date(today.getFullYear(), today.getMonth(), 0).getDate(); m--; }
            if (m < 0) { m += 12; y--; }
            durationText = `${y}  Ø³Ù†Ø© <br> ${m}Ø´Ù‡Ø± <br> ${d} ÙŠÙˆÙ…`;
        } else {
            durationText = "Ø§Ù„ØªØ§Ø±ÙŠØ® Ù…Ø³ØªÙ‚Ø¨Ù„ÙŠ";
        }
    }

    // 2. Ø¹Ø±Ø¶ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ø£Ø³Ø§Ø³ÙŠØ© (Ù…ÙˆØ¬ÙˆØ¯ Ø£ØµÙ„Ø§Ù‹ ÙÙŠ ÙƒÙˆØ¯Ùƒ)
    let html = Object.entries(emp.details).map(([k,v]) => 
        `<div class="bg-slate-50 p-4 rounded-2xl border border-slate-100">
            <p class="text-[9px] text-slate-400 uppercase mb-1 font-black">${k}</p>
            <p class="text-slate-800 font-black text-xs">${v || '-'}</p>
        </div>`
    ).join('');

    // 3. Ø¥Ø¶Ø§ÙØ© Ø¨Ø·Ø§Ù‚Ø© "Ù…Ø¯Ø© Ø§Ù„Ø¹Ù…Ù„" Ø§Ù„Ø¬Ø¯ÙŠØ¯Ø© Ù„ØªØ¸Ù‡Ø± ÙÙŠ Ø§Ù„Ø³Ø¬Ù„ (Ù…Ø«Ù„ ØµÙˆØ±ØªÙƒ)
    html += `
        <div class="bg-blue-50 p-4 rounded-2xl border border-blue-200 shadow-sm">
            <p class="text-[9px] text-blue-500 uppercase mb-1 font-black">Ù…Ø¯Ø© Ø§Ù„Ø®Ø¯Ù…Ø©</p>
            <p class="text-blue-900 font-black text-xs">${durationText}</p>
        </div>
    `;

    grid.innerHTML = html;
}

        // --- Task Logic with Filtering ---
        function filterProfileTasks() {
            const emp = employees.find(e => e.id == currentEmpId);
            const filterVal = document.getElementById('taskFilter').value;
            renderTaskTable(emp, filterVal);
        }

        function renderTaskTable(emp, filter = "Ø§Ù„ÙƒÙ„") {
            let tasks = emp.tasks || [];
            if (filter !== "Ø§Ù„ÙƒÙ„") {
                tasks = tasks.filter(t => t.type === filter);
            }
            document.getElementById('tasksListBody').innerHTML = tasks.map(t => `<tr class="hover:bg-slate-50 border-b"><td class="p-4 text-xs">${t.date}</td><td class="p-4 text-slate-800">${t.type}</td><td class="p-4 text-center font-black text-blue-600">${t.quality}%</td><td class="p-4 text-center font-bold">${t.count}</td></tr>`).join('') || `<tr><td colspan="4" class="p-8 text-center text-slate-300 italic">Ù„Ø§ ØªÙˆØ¬Ø¯ Ø³Ø¬Ù„Ø§Øª ØªØ·Ø§Ø¨Ù‚ Ø§Ù„ÙÙ„ØªØ±</td></tr>`;
        }

        function renderActionTable(emp) { document.getElementById('profileActionsTable').innerHTML = (emp.actions||[]).map(act => `<tr class="hover:bg-red-50 border-b"><td class="p-3 text-[9px]">${act.date}</td><td class="p-3 text-red-600">${act.type}</td><td class="p-3 text-slate-500">${act.reason}</td></tr>`).join('') || '<tr><td colspan="3" class="p-4 text-center text-slate-300">Ù„Ø§ ÙŠÙˆØ¬Ø¯</td></tr>'; }
function renderLeaveTable(emp) { 
    const body = document.getElementById('profileLeavesTable'); 
    body.innerHTML = (emp.leaves||[]).map((l, index) => {
        // ØªÙ†Ø³ÙŠÙ‚ Ø¹Ø±Ø¶ Ø§Ù„ØªØ§Ø±ÙŠØ®
        let dateDisplay = "";
        if (l.from && l.to) {
            if (l.from === l.to) dateDisplay = l.from; // ÙŠÙˆÙ… ÙˆØ§Ø­Ø¯
            else dateDisplay = `<span class="block">${l.from}</span><span class="text-[8px] text-slate-400">Ø¥Ù„Ù‰</span><span class="block">${l.to}</span>`;
        } else {
            dateDisplay = l.date; // Ù„Ù„Ù†Ø¸Ø§Ù… Ø§Ù„Ù‚Ø¯ÙŠÙ…
        }

        return `<tr class="hover:bg-emerald-50 border-b">
            <td class="p-3 text-[9px] font-bold">${dateDisplay}</td>
            <td class="p-3 text-emerald-600">${l.type}</td>
            <td class="p-3 text-slate-500 max-w-[100px] truncate text-[10px]">${l.reason}</td>
            <td class="p-3 flex gap-1 justify-end">
                <button onclick="editLeave(${index})" class="text-blue-500 hover:bg-blue-100 p-1 rounded">âœ</button>
                <button onclick="deleteLeave(${index})" class="text-red-500 hover:bg-red-100 p-1 rounded">ğŸ—‘</button>
            </td>
        </tr>`;
    }).join('') || '<tr><td colspan="4" class="p-4 text-center text-slate-300">Ù„Ø§ ÙŠÙˆØ¬Ø¯ Ø¥Ø¬Ø§Ø²Ø§Øª</td></tr>'; 
}
        function toggleEditProfile() {
            const emp = employees.find(e => e.id == currentEmpId);
            document.getElementById('btn-edit-toggle').classList.add('hidden');
            document.getElementById('btn-save-changes').classList.remove('hidden');
            const grid = document.getElementById('detailed-info-grid');
            grid.innerHTML = `<div class="bg-blue-50 p-5 rounded-[2rem] border col-span-full mb-4 font-black"><label class="text-[10px] text-blue-600">Ø§Ù„Ø§Ø³Ù…</label><input type="text" id="edit-name" value="${emp.name}" class="mt-2 bg-white"></div>` + 
                Object.entries(emp.details).map(([k,v]) => `<div class="bg-slate-50 p-4 rounded-2xl border border-slate-200"><label class="text-[10px] font-black text-slate-400">${k}</label><input type="text" id="edit-field-${k}" value="${v || ''}" class="mt-1 bg-white text-xs"></div>`).join('');
        }

        function saveProfileChanges() {
            const idx = employees.findIndex(e => e.id == currentEmpId);
            employees[idx].name = document.getElementById('edit-name').value;
            Object.keys(employees[idx].details).forEach(k => { const input = document.getElementById(`edit-field-${k}`); if(input) employees[idx].details[k] = input.value; });
            saveToStorage(); viewProfile(currentEmpId);
        }

        function deleteEmployeeProfile() { if (confirm("Ø­Ø°Ù Ø§Ù„Ù…ÙˆØ¸Ù Ù†Ù‡Ø§Ø¦ÙŠØ§Ù‹ØŸ")) { employees = employees.filter(e => e.id != currentEmpId); saveToStorage(); showSection('dashboard'); } }

        function saveAction() { const emp = employees.find(e => e.id == currentEmpId); emp.actions.push({ type: document.getElementById('act_type').value, date: document.getElementById('act_date').value, reason: document.getElementById('act_reason').value }); saveToStorage(); viewProfile(currentEmpId); closeModal('modalAction'); }
        
        function saveTask() { 
            const emp = employees.find(e => e.id == currentEmpId); 
            const type = document.getElementById('task_type').value;
            const quality = document.getElementById('task_quality').value;
            const count = document.getElementById('task_count').value;
            const date = document.getElementById('task_date').value;
            
            if(!date) return alert("ÙŠØ±Ø¬Ù‰ Ø§Ø®ØªÙŠØ§Ø± Ø§Ù„ØªØ§Ø±ÙŠØ®");
            
            emp.tasks.push({ 
                type: type, 
                quality: quality || 0, 
                count: count || 0, 
                date: date 
            }); 
            saveToStorage(); 
            viewProfile(currentEmpId); 
            closeModal('modalTask'); 
        }

        function saveWeeklySchedule() { const emp = employees.find(e => e.id == currentEmpId); weekDays.forEach(d => { emp.schedule[d] = { type: document.getElementById('type-'+d).value, from: document.getElementById('from-'+d).value, to: document.getElementById('to-'+d).value }; }); saveToStorage(); viewProfile(currentEmpId); closeModal('modalSchedule'); }
        function prepareScheduleModal() {
            const emp = employees.find(e => e.id == currentEmpId);
            document.getElementById('scheduleInputs').innerHTML = weekDays.map(day => {
                const s = emp.schedule[day] || { type: 'Ø¹Ù…Ù„', from: '08:00', to: '16:00' };
                return `<div class="flex items-center gap-4 bg-slate-50 p-4 rounded-3xl mb-2 font-black shadow-sm"><span class="w-16">${day}</span><select id="type-${day}" onchange="toggleDayRow('${day}')" class="w-32 text-xs"><option value="Ø¹Ù…Ù„" ${s.type==='Ø¹Ù…Ù„'?'selected':''}>ÙŠÙˆÙ… Ø¹Ù…Ù„</option><option value="Ø¹Ø·Ù„Ø©" ${s.type==='Ø¹Ø·Ù„Ø©'?'selected':''}>ÙŠÙˆÙ… Ø±Ø§Ø­Ø©</option></select><div id="times-${day}" class="flex gap-2 flex-1 ${s.type==='Ø¹Ø·Ù„Ø©'?'opacity-20 pointer-events-none':''}"><input type="time" id="from-${day}" value="${s.from}"><input type="time" id="to-${day}" value="${s.to}"></div></div>`;
            }).join('');
        }
        function toggleDayRow(day) { const t = document.getElementById(`type-${day}`).value; document.getElementById(`times-${day}`).style.opacity = t==='Ø¹Ø·Ù„Ø©'?'0.2':'1'; }
        function saveLeave() {
    const emp = employees.find(e => e.id == currentEmpId);
    const index = document.getElementById('leave_index').value;
    
    const dateFrom = document.getElementById('leave_from').value;
    const dateTo = document.getElementById('leave_to').value;
    const type = document.getElementById('leave_type').value;
    const reason = document.getElementById('leave_reason').value;

    // Ø§Ù„ØªØ­Ù‚Ù‚ Ù…Ù† ØµØ­Ø© Ø§Ù„ØªÙˆØ§Ø±ÙŠØ®
    if (!dateFrom || !dateTo) return alert("ÙŠØ±Ø¬Ù‰ ØªØ­Ø¯ÙŠØ¯ ØªØ§Ø±ÙŠØ® Ø§Ù„Ø¨Ø¯Ø§ÙŠØ© ÙˆØ§Ù„Ù†Ù‡Ø§ÙŠØ©");
    if (new Date(dateFrom) > new Date(dateTo)) return alert("ØªØ§Ø±ÙŠØ® Ø§Ù„Ù†Ù‡Ø§ÙŠØ© ÙŠØ¬Ø¨ Ø£Ù† ÙŠÙƒÙˆÙ† Ø¨Ø¹Ø¯ ØªØ§Ø±ÙŠØ® Ø§Ù„Ø¨Ø¯Ø§ÙŠØ©");

    // 1. Ù…Ù†Ø·Ù‚ Ø§Ø³ØªØ±Ø¬Ø§Ø¹ Ø§Ù„Ø±ØµÙŠØ¯ Ø§Ù„Ù‚Ø¯ÙŠÙ… ÙÙŠ Ø­Ø§Ù„Ø© Ø§Ù„ØªØ¹Ø¯ÙŠÙ„ (Ù‚Ø¨Ù„ Ø§Ù„Ø­ÙØ¸ Ø§Ù„Ø¬Ø¯ÙŠØ¯)
    if (index !== "") {
        const oldLeave = emp.leaves[index];
        // Ø¥Ø°Ø§ ÙƒØ§Ù†Øª Ø§Ù„Ø¥Ø¬Ø§Ø²Ø© Ø§Ù„Ù‚Ø¯ÙŠÙ…Ø© Ù…Ø®ØµÙˆÙ…Ø© Ù…Ù† Ø§Ù„Ø±ØµÙŠØ¯ØŒ Ù†Ø¹ÙŠØ¯ Ø§Ù„Ø£ÙŠØ§Ù… Ù„Ù„Ù…ÙˆØ¸Ù Ù…Ø¤Ù‚ØªØ§Ù‹
        if (oldLeave.type === 'Ø³Ù†ÙˆÙŠØ©' || oldLeave.type === 'Ø·Ø§Ø±Ø¦Ø©') {
            let oldDays = 0;
            if (oldLeave.from && oldLeave.to) {
                oldDays = calculateDaysDiff(oldLeave.from, oldLeave.to);
            } else {
                oldDays = 1; // Ù„Ù„Ù†Ø¸Ø§Ù… Ø§Ù„Ù‚Ø¯ÙŠÙ…
            }
            // ØªØ­ÙˆÙŠÙ„ Ø§Ù„Ø±ØµÙŠØ¯ Ù„Ø±Ù‚Ù… Ù„Ø¶Ù…Ø§Ù† Ø§Ù„Ø¬Ù…Ø¹ Ø§Ù„ØµØ­ÙŠØ­
            emp.details['Ø±ØµÙŠØ¯ Ø§Ù„Ø¥Ø¬Ø§Ø²Ø§Øª'] = parseInt(emp.details['Ø±ØµÙŠØ¯ Ø§Ù„Ø¥Ø¬Ø§Ø²Ø§Øª'] || 0) + oldDays;
        }
    }

    // 2. Ù…Ù†Ø·Ù‚ Ø§Ù„Ø®ØµÙ… Ø§Ù„Ø¬Ø¯ÙŠØ¯
    const newDaysCount = calculateDaysDiff(dateFrom, dateTo);
    
    // Ø§Ù„ØªØ­Ù‚Ù‚ Ù…Ù† Ø§Ù„ØªØ¹Ø§Ø±Ø¶Ø§Øª (ÙƒÙ…Ø§ ÙÙŠ Ø§Ù„ÙƒÙˆØ¯ Ø§Ù„Ø³Ø§Ø¨Ù‚)
    const requestedDates = getDatesInRange(dateFrom, dateTo);
    const conflicts = [];
    employees.forEach(otherEmp => {
        if (otherEmp.id != emp.id) {
            (otherEmp.leaves || []).forEach(l => {
                let existingDates = (l.from && l.to) ? getDatesInRange(l.from, l.to) : [l.date];
                if (requestedDates.some(reqDate => existingDates.includes(reqDate))) {
                    if (!conflicts.includes(otherEmp.name)) conflicts.push(otherEmp.name);
                }
            });
        }
    });
    if (conflicts.length > 0 && !confirm(`ØªÙ†Ø¨ÙŠÙ‡ ØªØ¹Ø§Ø±Ø¶: (${conflicts.join(', ')}) Ù„Ø¯ÙŠÙ‡Ù… Ø¥Ø¬Ø§Ø²Ø©. Ù…ØªØ§Ø¨Ø¹Ø©ØŸ`)) {
        // Ø¥Ø°Ø§ Ø£Ù„ØºÙ‰ Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù… Ø§Ù„Ø¹Ù…Ù„ÙŠØ© ÙˆÙƒØ§Ù† ÙÙŠ ÙˆØ¶Ø¹ Ø§Ù„ØªØ¹Ø¯ÙŠÙ„ØŒ ÙŠØ¬Ø¨ Ø£Ù† Ù†Ù„ØºÙŠ Ø§Ø³ØªØ±Ø¬Ø§Ø¹ Ø§Ù„Ø±ØµÙŠØ¯ Ø§Ù„Ø°ÙŠ Ù‚Ù…Ù†Ø§ Ø¨Ù‡ ÙÙŠ Ø§Ù„Ø®Ø·ÙˆØ© 1
        // Ù„ÙƒÙ† Ù„Ù„ØªØ¨Ø³ÙŠØ· Ù‡Ù†Ø§ØŒ Ø³Ù†Ù‚ÙˆÙ… Ø¨Ø¥Ø¹Ø§Ø¯Ø© ØªØ­Ù…ÙŠÙ„ Ø§Ù„ØµÙØ­Ø© Ø£Ùˆ ØªØ¬Ø§Ù‡Ù„ Ø§Ù„ØªØºÙŠÙŠØ±ØŒ 
        // Ø§Ù„Ø£ÙØ¶Ù„ Ù‡Ù†Ø§ Ø¥Ø¹Ø§Ø¯Ø© Ø§Ù„Ø¯Ø§Ù„Ø© Ø¯ÙˆÙ† Ø­ÙØ¸.
        return; 
    }

    // ØªØ·Ø¨ÙŠÙ‚ Ø§Ù„Ø®ØµÙ… Ù…Ù† Ø§Ù„Ø±ØµÙŠØ¯ Ø¥Ø°Ø§ ÙƒØ§Ù† Ø§Ù„Ù†ÙˆØ¹ Ø³Ù†ÙˆÙŠØ© Ø£Ùˆ Ø·Ø§Ø±Ø¦Ø©
    if (type === 'Ø³Ù†ÙˆÙŠØ©' || type === 'Ø·Ø§Ø±Ø¦Ø©') {
        const currentBalance = parseInt(emp.details['Ø±ØµÙŠØ¯ Ø§Ù„Ø¥Ø¬Ø§Ø²Ø§Øª'] || 0);
        // ÙŠÙ…ÙƒÙ†Ùƒ ØªÙØ¹ÙŠÙ„ Ø§Ù„Ø³Ø·Ø± Ø§Ù„ØªØ§Ù„ÙŠ Ø¥Ø°Ø§ Ø£Ø±Ø¯Øª Ù…Ù†Ø¹ Ø§Ù„Ø¥Ø¬Ø§Ø²Ø© ÙÙŠ Ø­Ø§Ù„ Ø¹Ø¯Ù… ÙˆØ¬ÙˆØ¯ Ø±ØµÙŠØ¯
        // if (currentBalance < newDaysCount) return alert("Ø¹Ø°Ø±Ø§Ù‹ØŒ Ø±ØµÙŠØ¯ Ø§Ù„Ø¥Ø¬Ø§Ø²Ø§Øª Ù„Ø§ ÙŠÙƒÙÙŠ!");
        
        emp.details['Ø±ØµÙŠØ¯ Ø§Ù„Ø¥Ø¬Ø§Ø²Ø§Øª'] = currentBalance - newDaysCount;
    }

    const data = { type: type, from: dateFrom, to: dateTo, reason: reason };
    
    if (index === "") {
        emp.leaves.push(data);
    } else {
        emp.leaves[index] = data;
    }

    saveToStorage();
    viewProfile(currentEmpId); // Ø³ÙŠØªÙ… ØªØ­Ø¯ÙŠØ« Ø¹Ø±Ø¶ Ø§Ù„Ø±ØµÙŠØ¯ Ù‡Ù†Ø§ ØªÙ„Ù‚Ø§Ø¦ÙŠØ§Ù‹
    closeModal('modalLeave');
}
function editLeave(i) { 
    const emp = employees.find(e => e.id == currentEmpId); 
    const l = emp.leaves[i]; 
    
    document.getElementById('leaveModalTitle').innerText = "ØªØ¹Ø¯ÙŠÙ„ Ø§Ù„Ø¥Ø¬Ø§Ø²Ø©"; 
    document.getElementById('leave_index').value = i; 
    document.getElementById('leave_type').value = l.type; 
    document.getElementById('leave_reason').value = l.reason; 

    // Ø§Ù„ØªØ¹Ø§Ù…Ù„ Ù…Ø¹ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ø¬Ø¯ÙŠØ¯Ø© ÙˆØ§Ù„Ù‚Ø¯ÙŠÙ…Ø©
    if (l.from && l.to) {
        document.getElementById('leave_from').value = l.from;
        document.getElementById('leave_to').value = l.to;
    } else if (l.date) {
        // Ø¥Ø°Ø§ ÙƒØ§Ù† Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª Ù‚Ø¯ÙŠÙ…Ø© (ØªØ§Ø±ÙŠØ® ÙˆØ§Ø­Ø¯)ØŒ Ù†Ø¶Ø¹Ù‡ ÙÙŠ Ø§Ù„Ø¨Ø¯Ø§ÙŠØ© ÙˆØ§Ù„Ù†Ù‡Ø§ÙŠØ©
        document.getElementById('leave_from').value = l.date;
        document.getElementById('leave_to').value = l.date;
    }

    openModal('modalLeave'); }
function deleteLeave(i) { 
    if(confirm("Ù‡Ù„ Ø£Ù†Øª Ù…ØªØ£ÙƒØ¯ Ù…Ù† Ø­Ø°Ù Ø§Ù„Ø¥Ø¬Ø§Ø²Ø©ØŸ Ø³ÙŠØªÙ… Ø§Ø³ØªØ±Ø¬Ø§Ø¹ Ø§Ù„Ø±ØµÙŠØ¯ Ø§Ù„Ù…Ø®ØµÙˆÙ… Ø¥Ù† ÙˆØ¬Ø¯.")) { 
        const emp = employees.find(e => e.id == currentEmpId);
        const leave = emp.leaves[i];

        // Ø§Ø³ØªØ±Ø¬Ø§Ø¹ Ø§Ù„Ø±ØµÙŠØ¯ Ø¥Ø°Ø§ ÙƒØ§Ù†Øª Ø³Ù†ÙˆÙŠØ© Ø£Ùˆ Ø·Ø§Ø±Ø¦Ø©
        if (leave.type === 'Ø³Ù†ÙˆÙŠØ©' || leave.type === 'Ø·Ø§Ø±Ø¦Ø©') {
            let daysToRestore = 0;
            if (leave.from && leave.to) {
                daysToRestore = calculateDaysDiff(leave.from, leave.to);
            } else {
                daysToRestore = 1; // Ø¯Ø¹Ù… Ø§Ù„Ù†Ø¸Ø§Ù… Ø§Ù„Ù‚Ø¯ÙŠÙ…
            }
            
            emp.details['Ø±ØµÙŠØ¯ Ø§Ù„Ø¥Ø¬Ø§Ø²Ø§Øª'] = parseInt(emp.details['Ø±ØµÙŠØ¯ Ø§Ù„Ø¥Ø¬Ø§Ø²Ø§Øª'] || 0) + daysToRestore;
        }

        // Ø­Ø°Ù Ø§Ù„Ø¥Ø¬Ø§Ø²Ø© Ù…Ù† Ø§Ù„Ù…ØµÙÙˆÙØ©
        emp.leaves.splice(i, 1); 
        
        saveToStorage(); 
        viewProfile(currentEmpId); 
    } 
}
        function saveNewEmployee(e) {
            e.preventDefault(); const id = document.getElementById('f_id').value;
            if(employees.some(emp => emp.id == id)) return alert("Ø§Ù„Ø±Ù‚Ù… Ù…Ø³Ø¬Ù„!");
            employees.push({
                id: id, name: document.getElementById('f_name').value,
                details: { "Ø§Ù„Ù‚Ø³Ù…": document.getElementById('f_dept').value, "Ø§Ù„Ù…Ø³Ù…Ù‰": document.getElementById('f_pos').value, "Ø§Ù„Ø±Ø§ØªØ¨": document.getElementById('f_salary').value, "Ø§Ù„Ù‡Ø§ØªÙ": document.getElementById('f_phone').value, "ØªØ§Ø±ÙŠØ® Ø§Ù„Ù…ÙŠÙ„Ø§Ø¯": document.getElementById('f_dob').value, "ÙØµÙŠÙ„Ø© Ø§Ù„Ø¯Ù…": document.getElementById('f_blood').value, "Ø§Ù„Ø¹Ù†ÙˆØ§Ù†": document.getElementById('f_address').value, "Ø¨Ø¯Ø§ÙŠØ© Ø§Ù„Ø¹Ù…Ù„": document.getElementById('f_start_date').value, "Ø±ØµÙŠØ¯ Ø§Ù„Ø¥Ø¬Ø§Ø²Ø§Øª": document.getElementById('f_leave_bal').value, "Ø§Ù„Ø¬Ù†Ø³ÙŠØ©": document.getElementById('f_nat').value },
                schedule: {}, actions: [], tasks: [], leaves: []
            });
            saveToStorage(); showSection('dashboard');
        }

        function searchEmployees() { const v = document.getElementById('empSearch').value.toLowerCase(); renderEmployeeList(employees.filter(e => e.name.toLowerCase().includes(v) || e.id.toLowerCase().includes(v))); }
        function renderEmployeeList(data = employees) { document.getElementById('employeesTableBody').innerHTML = data.map(emp => `<tr class="hover:bg-slate-50 border-b font-bold"><td class="p-5">${emp.name} <span class="text-slate-300">#${emp.id}</span></td><td class="p-5 text-slate-500">${emp.details['Ø§Ù„Ù‚Ø³Ù…']}</td><td class="p-5 text-center"><button onclick="viewProfile('${emp.id}')" class="bg-blue-50 text-blue-700 px-8 py-2 rounded-2xl font-black text-xs hover:bg-blue-600 hover:text-white transition-all">Ø¹Ø±Ø¶</button></td></tr>`).join(''); }
        function updateDashboardStats() {
            document.getElementById('stat-emp-count').innerText = employees.length;
            let a=0, l=0; employees.forEach(e => { a+=(e.actions||[]).length; l+=(e.leaves||[]).length; });
            document.getElementById('stat-action-count').innerText = a; document.getElementById('stat-leave-count').innerText = l;
        }
        function renderUpcomingBirthdays() {
            const checkDate = new Date(systemDate);
            const list = employees.filter(e => { 
                if(!e.details['ØªØ§Ø±ÙŠØ® Ø§Ù„Ù…ÙŠÙ„Ø§Ø¯']) return false; 
                const b = new Date(e.details['ØªØ§Ø±ÙŠØ® Ø§Ù„Ù…ÙŠÙ„Ø§Ø¯']); 
                return b.getMonth() === checkDate.getMonth(); 
            });
            document.getElementById('birthdayList').innerHTML = list.map(e => `<div class="p-3 bg-slate-50 rounded-xl flex justify-between items-center text-[10px] font-black border border-slate-100"><span>${e.name}</span><span class="text-blue-600">${e.details['ØªØ§Ø±ÙŠØ® Ø§Ù„Ù…ÙŠÙ„Ø§Ø¯']}</span></div>`).join('') || '<p class="text-center text-slate-300 italic py-4 text-xs">Ù„Ø§ ÙŠÙˆØ¬Ø¯ Ù‡Ø°Ø§ Ø§Ù„Ø´Ù‡Ø±</p>';
        }
        function filterEmployeesByStat(type) {
            let filtered = [];
            if(type === 'actions') filtered = employees.filter(e => (e.actions||[]).length > 0);
            else if(type === 'leaves') filtered = employees.filter(e => (e.leaves||[]).length > 0);
            showSection('employees'); renderEmployeeList(filtered);
        }
        function downloadFullBackup() { const a = document.createElement("a"); a.href = URL.createObjectURL(new Blob([JSON.stringify(employees)], {type:"application/json"})); a.download = "HR_Backup.json"; a.click(); }

        async function callGemini(prompt) {
            if(!apiKey) throw new Error("API Key Missing");
            const r = await fetch(`https://generativelanguage.googleapis.com/v1beta/models/gemini-2.5-flash-preview-09-2025:generateContent?key=${apiKey}`, { method: 'POST', body: JSON.stringify({ contents: [{ parts: [{ text: prompt }] }] }) });
            const res = await r.json(); return res.candidates[0].content.parts[0].text;
        }
        async function analyzePerformanceWithAI() {
            const emp = employees.find(e => e.id == currentEmpId); openModal('modalAI');
            document.getElementById('aiResultContent').innerHTML = `<p class="animate-pulse text-xs">Ø¬Ø§Ø±ÙŠ Ø§Ù„ØªØ­Ù„ÙŠÙ„...</p>`;
            try {
                const r = await callGemini(`Ø­Ù„Ù„ Ø£Ø¯Ø§Ø¡ Ø§Ù„Ù…ÙˆØ¸Ù: ${emp.name}.`);
                document.getElementById('aiResultContent').innerHTML = `<div class="prose font-bold text-[10px] leading-relaxed text-slate-700">${r.replace(/\n/g, '<br>')}</div>`;
            } catch(e) { document.getElementById('aiResultContent').innerHTML = `<p class="text-red-500 font-bold">ÙŠØ±Ø¬Ù‰ Ø¥Ø¶Ø§ÙØ© Ù…ÙØªØ§Ø­ API.</p>`; }
        }

        window.onload = () => {
            updateSystemDateUI();
            showSection('dashboard');
        };
		function calculateWorkDuration() {
    const startDateVal = document.getElementById('f_start_date').value;
    const resultDisplay = document.getElementById('duration_result');
    
    if (!startDateVal) return;

    const startDate = new Date(startDateVal);
    const today = new Date(systemDate); // ØªØ³ØªØ®Ø¯Ù… ØªØ§Ø±ÙŠØ® Ø§Ù„Ù†Ø¸Ø§Ù… Ø§Ù„Ø®Ø§Øµ Ø¨Ùƒ

    if (startDate > today) {
        resultDisplay.innerText = "ØªØ§Ø±ÙŠØ® Ø§Ù„Ø¨Ø¯Ø¡ Ù…Ø³ØªÙ‚Ø¨Ù„ÙŠ!";
        resultDisplay.style.color = "red";
        return;
    }

    let years = today.getFullYear() - startDate.getFullYear();
    let months = today.getMonth() - startDate.getMonth();
    let days = today.getDate() - startDate.getDate();

    if (days < 0) {
        months--;
        days += new Date(today.getFullYear(), today.getMonth(), 0).getDate();
    }
    if (months < 0) {
        years--;
        months += 12;
    }

    resultDisplay.style.color = "#1e40af";
    resultDisplay.innerText = `${years} Ø³Ù†Ø© Ùˆ ${months} Ø´Ù‡Ø± Ùˆ ${days} ÙŠÙˆÙ…`;
}
// Ø¯Ø§Ù„Ø© Ù…Ø³Ø§Ø¹Ø¯Ø© Ù„ØªÙˆÙ„ÙŠØ¯ Ù…ØµÙÙˆÙØ© Ø¨Ø¬Ù…ÙŠØ¹ Ø§Ù„Ø£ÙŠØ§Ù… Ø¨ÙŠÙ† ØªØ§Ø±ÙŠØ®ÙŠÙ†
function getDatesInRange(startDate, endDate) {
    const dates = [];
    let currentDate = new Date(startDate);
    const end = new Date(endDate);
    while (currentDate <= end) {
        dates.push(currentDate.toISOString().split('T')[0]);
        currentDate.setDate(currentDate.getDate() + 1);
    }
    return dates;
}
function calculateDaysDiff(start, end) {
    const date1 = new Date(start);
    const date2 = new Date(end);
    // Ø§Ù„ÙØ±Ù‚ Ø¨Ø§Ù„Ù…Ù„ÙŠ Ø«Ø§Ù†ÙŠØ© Ù…Ù‚Ø³ÙˆÙ…Ø§Ù‹ Ø¹Ù„Ù‰ (ÙŠÙˆÙ… ÙˆØ§Ø­Ø¯ Ø¨Ø§Ù„Ù…Ù„ÙŠ Ø«Ø§Ù†ÙŠØ©) + 1 Ù„Ø£Ù† Ø§Ù„ÙŠÙˆÙ… Ø§Ù„Ø£ÙˆÙ„ Ù…Ø­Ø³ÙˆØ¨
    const diffTime = Math.abs(date2 - date1);
    const diffDays = Math.ceil(diffTime / (1000 * 60 * 60 * 24)) + 1; 
    return diffDays;
}// 1. Ø¯Ø§Ù„Ø© ØªØ¬Ù‡ÙŠØ² ÙˆÙØªØ­ Ù†Ø§ÙØ°Ø© Ø§Ù„Ø¥Ø¶Ø§ÙÙŠ
function prepareOvertimeModal() {
    const emp = employees.find(e => e.id == currentEmpId);
    // Ø­Ø³Ø§Ø¨ Ø§Ù„Ø³Ø§Ø¹Ø§Øª Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù…Ø©
    const usedHours = (emp.overtime || []).reduce((sum, item) => sum + parseFloat(item.hours), 0);
    const remaining = 20 - usedHours;

    document.getElementById('overtime_remaining_display').innerText = remaining;
    document.getElementById('overtime_date').value = new Date().toISOString().split('T')[0]; // ØªØ§Ø±ÙŠØ® Ø§Ù„ÙŠÙˆÙ… Ø§ÙØªØ±Ø§Ø¶ÙŠØ§Ù‹
    document.getElementById('overtime_hours').value = "";
    
    if (remaining <= 0) {
        alert("ØªÙ†Ø¨ÙŠÙ‡: Ù„Ù‚Ø¯ Ø§Ø³ØªÙ†ÙØ° Ù‡Ø°Ø§ Ø§Ù„Ù…ÙˆØ¸Ù Ø±ØµÙŠØ¯ Ø§Ù„Ø¥Ø¶Ø§ÙÙŠ Ø¨Ø§Ù„ÙƒØ§Ù…Ù„ (20 Ø³Ø§Ø¹Ø©).");
    }
    
    openModal('modalOvertime');
}

// 2. Ø¯Ø§Ù„Ø© Ø­ÙØ¸ Ø§Ù„Ø¥Ø¶Ø§ÙÙŠ Ù…Ø¹ Ø§Ù„ØªØ­Ù‚Ù‚ Ù…Ù† Ø§Ù„Ø±ØµÙŠØ¯
function saveOvertime() {
    const emp = employees.find(e => e.id == currentEmpId);
    
    // Ø§Ù„ØªØ£ÙƒØ¯ Ù…Ù† ÙˆØ¬ÙˆØ¯ Ù…ØµÙÙˆÙØ© Ù„Ù„Ø¥Ø¶Ø§ÙÙŠ
    if (!emp.overtime) emp.overtime = [];

    const date = document.getElementById('overtime_date').value;
    const hours = parseFloat(document.getElementById('overtime_hours').value);
    const reason = document.getElementById('overtime_reason').value;

    if (!date || !hours || hours <= 0) return alert("ÙŠØ±Ø¬Ù‰ Ø¥Ø¯Ø®Ø§Ù„ Ø¨ÙŠØ§Ù†Ø§Øª ØµØ­ÙŠØ­Ø©");

    // Ø§Ù„ØªØ­Ù‚Ù‚ Ù…Ù† Ø§Ù„Ø­Ø¯ Ø§Ù„Ø£Ù‚ØµÙ‰ (20 Ø³Ø§Ø¹Ø©)
    const currentUsed = emp.overtime.reduce((sum, item) => sum + parseFloat(item.hours), 0);
    const newTotal = currentUsed + hours;

    if (newTotal > 20) {
        alert(`Ù„Ø§ ÙŠÙ…ÙƒÙ† Ø§Ù„Ø¥Ø¶Ø§ÙØ©! \nØ§Ù„Ø±ØµÙŠØ¯ Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù…: ${currentUsed} Ø³Ø§Ø¹Ø©.\nØ§Ù„Ø¥Ø¶Ø§ÙØ© Ø§Ù„Ù…Ø·Ù„ÙˆØ¨Ø©: ${hours} Ø³Ø§Ø¹Ø©.\nØ§Ù„Ù…Ø¬Ù…ÙˆØ¹ Ø³ÙŠØªØ¬Ø§ÙˆØ² Ø§Ù„Ø­Ø¯ Ø§Ù„Ø£Ù‚ØµÙ‰ (20 Ø³Ø§Ø¹Ø©).`);
        return;
    }

    // Ø¥Ø¶Ø§ÙØ© Ø§Ù„Ø³Ø¬Ù„
    emp.overtime.push({
        date: date,
        hours: hours,
        reason: reason
    });

    saveToStorage();
    viewProfile(currentEmpId); // ØªØ­Ø¯ÙŠØ« Ø§Ù„Ø¹Ø±Ø¶
    closeModal('modalOvertime');
}

// 3. Ø¯Ø§Ù„Ø© Ø¹Ø±Ø¶ Ø¬Ø¯ÙˆÙ„ Ø§Ù„Ø¥Ø¶Ø§ÙÙŠ ÙÙŠ Ø§Ù„Ø¨Ø±ÙˆÙØ§ÙŠÙ„
function renderOvertimeTable(emp) {
    const tbody = document.getElementById('profileOvertimeTable');
    const records = emp.overtime || [];
    
    // Ø­Ø³Ø§Ø¨ Ø§Ù„Ø¥Ø­ØµØ§Ø¦ÙŠØ§Øª
    const totalHours = records.reduce((sum, item) => sum + parseFloat(item.hours), 0);
    const remaining = 20 - totalHours;

    // ØªØ­Ø¯ÙŠØ« Ø´Ø±ÙŠØ· Ø§Ù„Ø­Ø§Ù„Ø© ÙÙŠ Ø±Ø£Ø³ Ø§Ù„Ø¬Ø¯ÙˆÙ„
    document.getElementById('profile-overtime-stats').innerHTML = 
        `Ù…Ø³ØªØ®Ø¯Ù…: <span class="text-red-600">${totalHours}</span> | Ù…ØªØ¨Ù‚ÙŠ: <span class="text-green-600">${remaining}</span>`;

    // Ø±Ø³Ù… Ø§Ù„Ø¬Ø¯ÙˆÙ„
    tbody.innerHTML = records.map((item, index) => `
        <tr class="hover:bg-orange-50 transition">
            <td class="p-3 text-slate-500">${item.date}</td>
            <td class="p-3 text-orange-600 text-lg">${item.hours}</td>
            <td class="p-3 text-slate-700">${item.reason}</td>
            <td class="p-3 text-left">
                <button onclick="deleteOvertime(${index})" class="text-red-400 hover:text-red-600 font-bold transition">âœ•</button>
            </td>
        </tr>
    `).join('') || '<tr><td colspan="4" class="p-6 text-center text-slate-300 italic">Ù„Ø§ ÙŠÙˆØ¬Ø¯ Ø³Ø§Ø¹Ø§Øª Ø¥Ø¶Ø§ÙÙŠØ© Ù…Ø³Ø¬Ù„Ø©</td></tr>';
}

// 4. Ø¯Ø§Ù„Ø© Ø­Ø°Ù Ø³Ø¬Ù„ Ø¥Ø¶Ø§ÙÙŠ
function deleteOvertime(index) {
    if (confirm("Ù‡Ù„ ØªØ±ÙŠØ¯ Ø­Ø°Ù Ø³Ø¬Ù„ Ø§Ù„Ø¥Ø¶Ø§ÙÙŠ Ù‡Ø°Ø§ØŸ")) {
        const emp = employees.find(e => e.id == currentEmpId);
        emp.overtime.splice(index, 1);
        saveToStorage();
        viewProfile(currentEmpId);
    }
}
function downloadOvertimeExcel() {
    const startDateVal = document.getElementById('export_start_date').value;
    const endDateVal = document.getElementById('export_end_date').value;

    if (!startDateVal || !endDateVal) return alert("ÙŠØ±Ø¬Ù‰ ØªØ­Ø¯ÙŠØ¯ Ø§Ù„ÙØªØ±Ø© (Ù…Ù† - Ø¥Ù„Ù‰) Ø£ÙˆÙ„Ø§Ù‹");
    if (new Date(startDateVal) > new Date(endDateVal)) return alert("ØªØ§Ø±ÙŠØ® Ø§Ù„Ø¨Ø¯Ø§ÙŠØ© ÙŠØ¬Ø¨ Ø£Ù† ÙŠÙƒÙˆÙ† Ù‚Ø¨Ù„ ØªØ§Ø±ÙŠØ® Ø§Ù„Ù†Ù‡Ø§ÙŠØ©");

    // 1. ØªØ¬Ù‡ÙŠØ² Ø±Ø£Ø³ Ø§Ù„Ø¬Ø¯ÙˆÙ„ (Headers)
    // \uFEFF Ù‡Ùˆ Ø±Ù…Ø² BOM Ù„Ø¬Ø¹Ù„ Ø§Ù„Ø¥ÙƒØ³Ù„ ÙŠÙ‚Ø±Ø£ Ø§Ù„Ø¹Ø±Ø¨ÙŠØ© Ø¨Ø´ÙƒÙ„ ØµØ­ÙŠØ­
    let csvContent = "\uFEFF"; 
    csvContent += "Ø§Ù„Ø§Ø³Ù… Ø§Ù„ÙƒØ§Ù…Ù„,Ø§Ù„Ø±Ù‚Ù… Ø§Ù„ÙˆØ¸ÙŠÙÙŠ,Ø§Ù„Ù‚Ø³Ù…,Ø§Ù„ØªØ§Ø±ÙŠØ®,Ø¹Ø¯Ø¯ Ø§Ù„Ø³Ø§Ø¹Ø§Øª,Ø§Ù„Ø³Ø¨Ø¨\n";

    let totalHoursAll = 0;
    let recordsFound = 0;

    // 2. ØªØ¬Ù…ÙŠØ¹ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª
    employees.forEach(emp => {
        if (emp.overtime && emp.overtime.length > 0) {
            emp.overtime.forEach(record => {
                // ÙÙ„ØªØ±Ø© Ø­Ø³Ø¨ Ø§Ù„ØªØ§Ø±ÙŠØ®
                if (record.date >= startDateVal && record.date <= endDateVal) {
                    // ØªÙ†Ø¸ÙŠÙ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª Ù…Ù† Ø§Ù„ÙÙˆØ§ØµÙ„ Ø§Ù„ØªÙŠ Ù‚Ø¯ ØªÙƒØ³Ø± Ù…Ù„Ù CSV
                    const cleanReason = (record.reason || "").replace(/,/g, " - ");
                    
                    const row = [
                        emp.name,
                        emp.id,
                        emp.details['Ø§Ù„Ù‚Ø³Ù…'] || "ØºÙŠØ± Ù…Ø­Ø¯Ø¯",
                        record.date,
                        record.hours,
                        cleanReason
                    ].join(",");

                    csvContent += row + "\n";
                    totalHoursAll += parseFloat(record.hours);
                    recordsFound++;
                }
            });
        }
    });

    if (recordsFound === 0) return alert("Ù„Ø§ ØªÙˆØ¬Ø¯ Ø³Ø¬Ù„Ø§Øª Ø¥Ø¶Ø§ÙÙŠ ÙÙŠ Ù‡Ø°Ù‡ Ø§Ù„ÙØªØ±Ø©.");

    // Ø¥Ø¶Ø§ÙØ© Ø³Ø·Ø± Ø§Ù„Ù…Ø¬Ù…ÙˆØ¹ Ø§Ù„Ù†Ù‡Ø§Ø¦ÙŠ
    csvContent += `\n,,,Ø§Ù„Ù…Ø¬Ù…ÙˆØ¹ Ø§Ù„ÙƒÙ„ÙŠ,${totalHoursAll} Ø³Ø§Ø¹Ø©,`;

    // 3. Ø¥Ù†Ø´Ø§Ø¡ ÙˆØªØ­Ù…ÙŠÙ„ Ø§Ù„Ù…Ù„Ù
    const blob = new Blob([csvContent], { type: 'text/csv;charset=utf-8;' });
    const link = document.createElement("a");
    const url = URL.createObjectURL(blob);
    
    link.setAttribute("href", url);
    link.setAttribute("download", `ØªÙ‚Ø±ÙŠØ±_Ø§Ù„Ø§Ø¶Ø§ÙÙŠ_${startDateVal}_Ø§Ù„Ù‰_${endDateVal}.csv`);
    link.style.visibility = 'hidden';
    
    document.body.appendChild(link);
    link.click();
    document.body.removeChild(link);
    
    closeModal('modalExportOvertime');
}
function importFullBackup(event) {
    const file = event.target.files[0];
    if (!file) return;

    const reader = new FileReader();
    reader.onload = function(e) {
        try {
            const importedData = JSON.parse(e.target.result);

            // Ø§Ù„ØªØ­Ù‚Ù‚ Ù…Ù† Ø£Ù† Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª Ø¹Ø¨Ø§Ø±Ø© Ø¹Ù† Ù…ØµÙÙˆÙØ© (Array) ÙƒÙ…Ø§ ÙŠØªÙˆÙ‚Ø¹ Ø§Ù„Ù†Ø¸Ø§Ù…
            if (Array.isArray(importedData)) {
                if (confirm("ØªØ­Ø°ÙŠØ±: Ø§Ø³ØªØ¹Ø§Ø¯Ø© Ø§Ù„Ù†Ø³Ø®Ø© Ø§Ù„Ø§Ø­ØªÙŠØ§Ø·ÙŠØ© Ø³ÙŠØ¤Ø¯ÙŠ Ø¥Ù„Ù‰ Ù…Ø³Ø­ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ø­Ø§Ù„ÙŠØ© ÙˆØ§Ø³ØªØ¨Ø¯Ø§Ù„Ù‡Ø§. Ù‡Ù„ Ø£Ù†Øª Ù…ØªØ£ÙƒØ¯ØŸ")) {
                    // 1. ØªØ­Ø¯ÙŠØ« Ø§Ù„Ù…ØµÙÙˆÙØ© ÙÙŠ Ø§Ù„Ø°Ø§ÙƒØ±Ø© Ø§Ù„Ù…Ø¤Ù‚ØªØ©
                    employees = importedData;
                    // 2. Ø­ÙØ¸ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ø¬Ø¯ÙŠØ¯Ø© ÙÙŠ localStorage
                    saveToStorage();
                    // 3. Ø¥Ø¹Ø§Ø¯Ø© ØªØ­Ù…ÙŠÙ„ Ø§Ù„ØµÙØ­Ø© Ù„ØªØ­Ø¯ÙŠØ« ÙƒÙ„ Ø§Ù„Ø¬Ø¯Ø§ÙˆÙ„ ÙˆÙ„ÙˆØ­Ø© Ø§Ù„ØªØ­ÙƒÙ…
                    window.location.reload();
                }
            } else {
                alert("Ø§Ù„Ù…Ù„Ù ØºÙŠØ± ØµØ­ÙŠØ­! ØªØ£ÙƒØ¯ Ù…Ù† Ø§Ø®ØªÙŠØ§Ø± Ù…Ù„Ù Ù†Ø³Ø®Ø© Ø§Ø­ØªÙŠØ§Ø·ÙŠØ© ØµØ§Ù„Ø­.");
            }
        } catch (err) {
            alert("Ø­Ø¯Ø« Ø®Ø·Ø£ Ø£Ø«Ù†Ø§Ø¡ Ù‚Ø±Ø§Ø¡Ø© Ø§Ù„Ù…Ù„Ù. ØªØ£ÙƒØ¯ Ø£Ù†Ù‡ Ù…Ù„Ù JSON Ø³Ù„ÙŠÙ….");
            console.error(err);
        }
    };
    reader.readAsText(file);
}
    </script>
</body>
</html>

